<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 H&O (http://www.h-o.nl)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php /* @var $this  Mage_Catalog_Block_option_List_Upsell */ ?>
<?php if(count($this->getItemCollection()->getItems())): ?>
<div class="block block-up-sell">
    <div class="block-title">
        <h2><?php echo $this->__('You may also be interested in the following product(s)') ?></h2>
    </div>
    <div class="block-content no-padding">
            <ol class="products-list">
           <?php $this->resetItemsIterator() ?>
           <?php for($_i=0;$_i<$this->getRowCount();$_i++): ?>
               <?php for($_j=0;$_j<$this->getColumnCount();$_j++): ?>
                   <?php if($_link=$this->getIterableItem()): ?>
                            <?php if ($_link->getTypeId() == 'bundle'):?>
                                <li class="upsell-bundle">
                                <?php $_optionsCollection = $_link->getTypeInstance(true)->getSelectionsCollection($_link->getTypeInstance(true)->getOptionsIds($_link), $_link);?>
                                <div class="row-fluid ">
                                    <h3 class="product-name"><a href="<?php echo $_link->getProductUrl() ?>" title="<?php echo $this->htmlEscape($_link->getName()) ?>"><?php echo $this->htmlEscape($_link->getName()) ?></a></h3>
                                    <?php $_total=0; ?>
                                    <?php foreach($_optionsCollection as $_option): ?>
                                    <?php $_total += $_option->getSelectionQty() * $_option->getFinalPrice(); ?>
                                    <div class="span2">
                                        <div class="content">
                                        <a href="<?php echo $_option->getProductUrl() ?>" class="product-image"><img src="<?php echo $_option->getThumbnailUrl(70,70); ?>"/></a>
                                        <h2 class="product-name"><a href="<?php echo $_option->getProductUrl() ?>"><?php echo $_option->getName(); ?></a></h2>
                                            <div class="price-box"><?php echo Mage::helper('core')->formatPrice($_option->getFinalPrice(), false); ?></div>
                                        <?php $_option->getSelectionQty(); ?>
                                        <?php if($_option->getRequired()): ?>
                                            <?php echo $this->setValidationContainer('bundle-option-'.$_option->getId().'-'.$_option->getSelectionId(), 'bundle-option-'.$_option->getId().'-container') ?>
                                        <?php endif; ?>
                                        </div>
                                    </div>
                                    <?php endforeach; ?>
                                    <div class="span2 pull-right">
                                        <h3 class="product-name"><a href="<?php echo $_link->getProductUrl() ?>" title="<?php echo $this->htmlEscape($_link->getName()) ?>"><?php echo $this->htmlEscape($_link->getName()) ?></a></h3>
                                        <?php if ($_link->getPriceType() == '1' /*Check if bundle price is fixed */ ):?>
                                        <div class="normal-price"><label><?php echo $this->__('Oude prijs') ?></label> <?php echo Mage::helper('core')->formatPrice($_total, false); ?></div>
                                        <?php $_save = $_total - $_link->getFinalPrice(); ?>
                                        <div class="save-price"><label><?php echo $this->__('Korting') ?></label> - <?php echo Mage::helper('core')->formatPrice($_save, false); ?></div>
                                        <div class="final-price"><label><?php echo $this->__('Prijs') ?></label><?php echo Mage::helper('core')->formatPrice($_link->getFinalPrice(), false); ?></div>
                                        <?php endif; ?>
                                        <?php echo $this->getPriceHtml($_link, true, '-upsell') ?>
                                        <a title="<?php echo $this->__('Add to Cart') ?>"
                                            class="btn btn-primary btn-cart"
                                            onclick="jQuery(this).button('loading');"
                                            data-loading-text="<?php echo "<i class='icon-plus'></i> ". $this->__('Addingâ€¦'); ?>"
                                            href="<?php echo $this->getAddToCartUrl($_link) ?>"
                                            rel="nofollow">
                                        <i class="icon-plus"></i> <?php echo $this->__('Add to Cart') ?>
                                        </a>
                                    </div>
                                </div>
                                </li>
                            <?php else: ?>
                                <li class="upsell-bundle">
                                    <?php echo $_link->getName().' '.$this->__('is not a not a bundle product'); ?>
                                </li>
                            <?php endif;?>
                   <?php endif; ?>
               <?php endfor; ?>
            <?php endfor; ?>
            </ol>
            <script type="text/javascript">/* decorateGeneric($$('.options-list li'), ['last']); */</script>
    </div>
</div>
<?php endif ?>